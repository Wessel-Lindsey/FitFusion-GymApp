<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>FriendsProfile.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=0;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">debug</a> &gt; <a href="index.source.html" class="el_package">com.example.gymapp23</a> &gt; <span class="el_source">FriendsProfile.java</span></div><h1>FriendsProfile.java</h1><pre class="source lang-java linenums">package com.example.gymapp23;

import android.content.Intent;
import android.graphics.Bitmap;
import android.graphics.BitmapFactory;
import android.os.AsyncTask;
import android.os.Bundle;

        import com.android.volley.Request;
        import com.android.volley.RequestQueue;
        import com.android.volley.Response;
        import com.android.volley.VolleyError;
        import com.android.volley.VolleyLog;
        import com.android.volley.toolbox.JsonArrayRequest;
        import com.android.volley.toolbox.JsonObjectRequest;
        import com.android.volley.toolbox.StringRequest;
        import com.android.volley.toolbox.Volley;
        import com.google.android.material.appbar.CollapsingToolbarLayout;
        import com.google.android.material.floatingactionbutton.FloatingActionButton;
        import com.google.android.material.snackbar.Snackbar;

        import androidx.appcompat.app.AppCompatActivity;
        import androidx.appcompat.widget.Toolbar;

        import android.text.Html;
        import android.util.Log;
        import android.view.View;
import android.view.ViewGroup;
import android.widget.Button;
        import android.widget.EditText;
import android.widget.ImageView;
import android.widget.LinearLayout;
import android.widget.ScrollView;
        import android.widget.TextView;
        import android.widget.Toast;

        import com.example.gymapp23.databinding.ActivityProfilePageBinding;

        import org.json.JSONArray;
        import org.json.JSONException;
        import org.json.JSONObject;
        import org.w3c.dom.Text;

import java.io.ByteArrayOutputStream;
import java.io.InputStream;
import java.net.HttpURLConnection;
import java.net.URL;


<span class="fc" id="L50">public class FriendsProfile extends AppCompatActivity {</span>
<span class="fc" id="L51">    public String GETUSERURL = &quot;http://coms-309-067.class.las.iastate.edu:8080/people/@/&quot;;</span>
<span class="fc" id="L52">    public String GETPOSTSURL = &quot;http://coms-309-067.class.las.iastate.edu:8080/posts&quot;;</span>
<span class="fc" id="L53">    private String TAG = MainActivity.class.getSimpleName(), feedStr;</span>
    private TextView userName, pointsTxt;
    private Button followBtn, showRoutines, showPosts;
    private String userGym;
    private LinearLayout profileInfo;
    String user, friend;

    private ImageView ProfilePicture;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
<span class="fc" id="L64">        super.onCreate(savedInstanceState);</span>
<span class="fc" id="L65">        setContentView(R.layout.activity_profile_page);</span>

<span class="fc" id="L67">        Intent intent = getIntent();</span>
<span class="fc" id="L68">        user = intent.getStringExtra(&quot;username&quot;);</span>
<span class="fc" id="L69">        friend = intent.getStringExtra(&quot;friend&quot;);</span>

        ViewGroup layout;
<span class="fc" id="L72">        FloatingActionButton home = findViewById(R.id.homePage);</span>

<span class="fc" id="L74">        userName = findViewById(R.id.userName);</span>
<span class="fc" id="L75">        followBtn = findViewById(R.id.userFollowBtn);</span>
<span class="fc" id="L76">        pointsTxt = findViewById(R.id.userProfilePointsTxt);</span>
<span class="fc" id="L77">        showRoutines = findViewById(R.id.showRoutines);</span>
<span class="fc" id="L78">        showPosts = findViewById(R.id.showPosts);</span>
<span class="fc" id="L79">        profileInfo = findViewById(R.id.profileInfo);</span>
<span class="fc" id="L80">        ProfilePicture = findViewById(R.id.PFP);</span>

<span class="fc" id="L82">        layout = (ViewGroup) (findViewById(R.id.postMyGymEtx)).getParent();</span>
<span class="fc" id="L83">        layout.removeView( findViewById(R.id.postMyGymEtx) );</span>
<span class="fc" id="L84">        layout = (ViewGroup) (findViewById(R.id.postMyGymBtn).getParent());</span>
<span class="fc" id="L85">        layout.removeView( findViewById(R.id.postMyGymBtn) );</span>
<span class="fc" id="L86">        layout = (ViewGroup) (findViewById(R.id.myGymChat_userProfilePage).getParent());</span>
<span class="fc" id="L87">        layout.removeView( findViewById(R.id.myGymChat_userProfilePage));</span>

<span class="fc" id="L89">        loadProfilePic();</span>

<span class="fc" id="L91">        loadUserInfo();</span>
<span class="fc" id="L92">        loadFeed();</span>

<span class="fc" id="L94">        userGym = getUserGym(); //call it initially otherwise null on first click</span>
<span class="fc" id="L95">        home.setOnClickListener(new View.OnClickListener() {</span>
            @Override
            public void onClick(View view) {
<span class="fc" id="L98">                Intent intent2 = new Intent(FriendsProfile.this, HomePage.class);</span>
<span class="fc" id="L99">                intent2.putExtra(&quot;username&quot;, intent.getStringExtra(LoginPage.USERNAME));</span>
<span class="fc" id="L100">                startActivity(intent2);</span>
<span class="fc" id="L101">                finish();</span>
<span class="fc" id="L102">            }</span>
        });
<span class="fc" id="L104">        followBtn.setOnClickListener(new View.OnClickListener() {</span>
            @Override
            public void onClick(View view) {
<span class="fc" id="L107">                    StringRequest stringRequest = new StringRequest(Request.Method.POST, GETUSERURL + user + &quot;/friend/&quot; + friend, new Response.Listener&lt;String&gt;() {</span>
                        @Override
                        public void onResponse(String response) {
<span class="fc" id="L110">                            Toast.makeText(FriendsProfile.this, &quot;Sent: &quot; + response.toString(), Toast.LENGTH_LONG).show();</span>
//                           nameView.setText(response.toString());
<span class="fc" id="L112">                        }</span>
<span class="fc" id="L113">                    }, new Response.ErrorListener() {</span>
                        @Override
                        public void onErrorResponse(VolleyError error) {
<span class="nc" id="L116">                            Toast.makeText(FriendsProfile.this, &quot;Error: &quot;+ error.toString(), Toast.LENGTH_LONG).show();</span>
//                           nameView.setText(error.toString());
<span class="nc" id="L118">                        }</span>
                    }
                    );

                    RequestQueue requestQueue;
<span class="fc" id="L123">                    requestQueue = Volley.newRequestQueue(FriendsProfile.this);</span>
<span class="fc" id="L124">                    requestQueue.add(stringRequest);</span>
<span class="fc" id="L125">            }</span>
        });
<span class="fc" id="L127">        showRoutines.setOnClickListener(new View.OnClickListener() {</span>
            @Override
            public void onClick(View v) {
<span class="fc" id="L130">                profileInfo.removeAllViews();</span>
<span class="fc" id="L131">                loadAllRoutines();</span>
<span class="fc" id="L132">            }</span>
        });
<span class="fc" id="L134">        showPosts.setOnClickListener(new View.OnClickListener() {</span>
            @Override
            public void onClick(View view) {
<span class="fc" id="L137">                profileInfo.removeAllViews();</span>
<span class="fc" id="L138">                loadFeed();</span>
<span class="fc" id="L139">            }</span>
        });
<span class="fc" id="L141">    }</span>
    private void loadUserInfo() {
        String feedStr;
<span class="fc" id="L144">        String URL = GETUSERURL + friend;</span>

<span class="fc" id="L146">        Toast.makeText(FriendsProfile.this, URL, Toast.LENGTH_LONG);</span>
<span class="fc" id="L147">        JsonObjectRequest jsonObjectRequest = new JsonObjectRequest</span>
<span class="fc" id="L148">                (Request.Method.GET, URL, null, new Response.Listener&lt;JSONObject&gt;() {</span>

                    @Override
                    public void onResponse(JSONObject response) {
                        //populate profile page
                        try {
<span class="fc" id="L154">                            userName.setText(response.getString(&quot;username&quot;));</span>
<span class="fc" id="L155">                            pointsTxt.setText(&quot;Points: &quot; +response.getInt(&quot;points&quot;));</span>
<span class="nc" id="L156">                        } catch (JSONException e) {</span>
<span class="nc" id="L157">                            throw new RuntimeException(e);</span>
<span class="fc" id="L158">                        }</span>


<span class="fc" id="L161">                    }</span>
<span class="fc" id="L162">                }, new Response.ErrorListener() {</span>

                    @Override
                    public void onErrorResponse(VolleyError error) {
<span class="nc" id="L166">                        Toast.makeText(FriendsProfile.this, &quot;Error getting user details&quot;, Toast.LENGTH_LONG).show();</span>
<span class="nc" id="L167">                    }</span>
                });
<span class="fc" id="L169">        RequestQueue rq = Volley.newRequestQueue(FriendsProfile.this);</span>
<span class="fc" id="L170">        rq.add(jsonObjectRequest);</span>
<span class="fc" id="L171">    }</span>
    private void loadFeed() {
<span class="fc" id="L173">        JsonArrayRequest postsGETRequest = new JsonArrayRequest(Request.Method.GET, GETPOSTSURL + &quot;/&quot; + friend, null, new Response.Listener&lt;JSONArray&gt;() {</span>
            @Override
            public void onResponse(JSONArray response) {
                try {
<span class="pc bpc" id="L177" title="1 of 2 branches missed.">                    if (response.length() == 0) {</span>
<span class="nc" id="L178">                        addTextCard(&quot;No posts here yet&quot;);</span>
                    }
                    else {
<span class="fc" id="L181">                        feedStr = &quot;&quot;;</span>
<span class="fc bfc" id="L182" title="All 2 branches covered.">                        for (int i = response.length()-1; i &gt;= 0; i--) {</span>

<span class="fc" id="L184">                            JSONObject object = response.getJSONObject(i);</span>
<span class="fc" id="L185">                            String title = object.getString(&quot;title&quot;);</span>
<span class="fc" id="L186">                            String message = object.getString(&quot;message&quot;);</span>
<span class="fc" id="L187">                            int likes = object.getInt(&quot;likes&quot;);</span>
<span class="fc" id="L188">                            feedStr = &quot;&lt;h2&gt;&lt;b&gt; &lt;span style=color:black&gt;&quot;+ title + &quot;:&lt;/span&gt; &lt;/b&gt;&lt;/h2&gt;&quot;</span>
                                    + &quot;&lt;p&gt;&quot; + message + &quot;&lt;p&gt;&lt;span style=color:#505050&gt; &quot; +
                                    &quot;Likes: &lt;/span&gt;&lt;b&gt;&lt;span style=color:#F06060&gt;&quot; + likes + &quot;&lt;/span&gt;&quot;;
                            //addCard(feedStr);
<span class="fc" id="L192">                            addPostCard(friend, response.getJSONObject(i));</span>
                        }
                    }
                }
<span class="nc" id="L196">                catch (JSONException e) {</span>
<span class="nc" id="L197">                    e.printStackTrace();</span>
<span class="fc" id="L198">                }</span>
<span class="fc" id="L199">            }</span>
<span class="fc" id="L200">        }, new Response.ErrorListener() {</span>
            @Override
            public void onErrorResponse(VolleyError error) {
<span class="nc" id="L203">                addTextCard(&quot;Error loading feed&quot;);</span>
<span class="nc" id="L204">                error.printStackTrace();</span>

<span class="nc" id="L206">            }</span>
        });

        RequestQueue requestQueue;
<span class="fc" id="L210">        requestQueue = Volley.newRequestQueue(FriendsProfile.this);</span>
<span class="fc" id="L211">        requestQueue.add(postsGETRequest);</span>
<span class="fc" id="L212">    }</span>
    private void loadAllRoutines() {
<span class="fc" id="L214">        String getAllRoutinesURL = &quot;http://coms-309-067.class.las.iastate.edu:8080/user/&quot; + friend + &quot;/routines&quot;;</span>

        //get request
<span class="fc" id="L217">        JsonArrayRequest jsonArrayRequest = new JsonArrayRequest</span>
<span class="fc" id="L218">                (Request.Method.GET, getAllRoutinesURL, null, new Response.Listener&lt;JSONArray&gt;() {</span>

                    @Override
                    public void onResponse(JSONArray response) {
                        //find highest id
                        JSONObject cur;
                        int id;
                        String msg;

//                        msg = &quot;&lt;h2&gt;&lt;b&gt;&lt;span style=color:black&gt;Latest Routine: &lt;/b&gt;&lt;/h2&gt;&quot;;


                        try {
                            //print out all routines
<span class="fc bfc" id="L232" title="All 2 branches covered.">                            for (int j = 0; j &lt; response.length(); j++) {</span>
<span class="fc" id="L233">                                cur = response.getJSONObject(j);</span>
<span class="fc" id="L234">                                JSONArray workouts = cur.getJSONArray(&quot;workouts&quot;);</span>
<span class="fc" id="L235">                                msg = &quot;&lt;h2&gt;&lt;span style=color:#64000A&gt;&quot; + cur.getString(&quot;name&quot;) + &quot;&lt;/span&gt;&lt;/h2&gt;&quot;;</span>

                                //iterate through all the workouts
<span class="fc bfc" id="L238" title="All 2 branches covered.">                                for (int i = 0; i &lt; workouts.length(); i++) {</span>
<span class="fc" id="L239">                                    JSONObject exercise = workouts.getJSONObject(i);</span>
<span class="fc" id="L240">                                    msg+= &quot;&lt;p&gt;&lt;b&gt;&lt;span style=color:black&gt;Exercise &quot; + (i+1) + &quot;: &lt;/b&gt;&lt;/style&gt;&lt;span style=color:#64000A&gt;&quot; + exercise.getString(&quot;name&quot;);</span>
                                    //+ &quot;&lt;/span&gt;\t&lt;b&gt;&lt;span style=color:black&gt;\tPR: &lt;/style&gt;&lt;/b&gt;&lt;span style=color:#64000A&gt;&quot; + exercise.getString(&quot;record&quot;) + &quot; &lt;/span&gt;&lt;b&gt;&lt;span style=color:black&gt; reps: &lt;/style&gt;&lt;/b&gt;&lt;span style=color:#64000A&gt;&quot; + exercise.getString(&quot;reps&quot;) + &quot;&lt;/span&gt;&lt;/p&gt;&quot;;
                                }

<span class="fc" id="L244">                                msg += &quot;&lt;p&gt;&lt;span style=color:black&gt;-------------------------------------------------&lt;/span&gt;&lt;/p&gt;&quot;;</span>
<span class="fc" id="L245">                                addTextCard(msg);</span>
                            }

                            //update GUI
//                            userRoutines.setText(Html.fromHtml(msg));
<span class="nc" id="L250">                        } catch (JSONException e) {</span>
<span class="nc" id="L251">                            throw new RuntimeException(e);</span>
<span class="fc" id="L252">                        }</span>
<span class="fc" id="L253">                    }</span>
<span class="fc" id="L254">                }, new Response.ErrorListener() {</span>

                    @Override
                    public void onErrorResponse(VolleyError error) {
<span class="nc" id="L258">                        Toast.makeText(FriendsProfile.this, &quot;Error getting User details&quot;, Toast.LENGTH_LONG).show();</span>
<span class="nc" id="L259">                    }</span>
                });


        RequestQueue requestQueue;
<span class="fc" id="L264">        requestQueue = Volley.newRequestQueue(FriendsProfile.this);</span>
<span class="fc" id="L265">        requestQueue.add(jsonArrayRequest);</span>

<span class="fc" id="L267">    }</span>
    private String getUserGym() {
<span class="fc" id="L269">        String URL = GETUSERURL + friend;</span>

<span class="fc" id="L271">        JsonObjectRequest jsonObjectRequest = new JsonObjectRequest</span>
<span class="fc" id="L272">                (Request.Method.GET, URL, null, new Response.Listener&lt;JSONObject&gt;() {</span>
                    @Override
                    public void onResponse(JSONObject response) {
                        try {
                            //Toast.makeText(FriendsProfile.this, response.toString(), Toast.LENGTH_LONG).show();
<span class="nc" id="L277">                            userGym = response.getJSONObject(&quot;myGym&quot;).getString(&quot;businessName&quot;);</span>
<span class="fc" id="L278">                        } catch (JSONException e) {</span>
<span class="fc" id="L279">                            userGym = &quot;stateGym&quot;;</span>
<span class="nc" id="L280">                        }</span>
<span class="fc" id="L281">                    }</span>
<span class="fc" id="L282">                }, new Response.ErrorListener() {</span>

                    @Override
                    public void onErrorResponse(VolleyError error) {
<span class="nc" id="L286">                        Toast.makeText(FriendsProfile.this, &quot;Error getting user details&quot;, Toast.LENGTH_LONG).show();</span>
<span class="nc" id="L287">                    }</span>
                });
<span class="fc" id="L289">        RequestQueue rq = Volley.newRequestQueue(FriendsProfile.this);</span>
<span class="fc" id="L290">        rq.add(jsonObjectRequest);</span>

<span class="fc" id="L292">        return userGym;</span>
    }
    private void addTextCard(String text){
<span class="fc" id="L295">        View view = getLayoutInflater().inflate(R.layout.simple_text_box, null);</span>
<span class="fc" id="L296">        TextView nameView = view.findViewById(R.id.textView);</span>

<span class="fc" id="L298">        nameView.setText(Html.fromHtml(text));</span>

<span class="fc" id="L300">        profileInfo.addView(view);</span>
<span class="fc" id="L301">    }</span>

    public void addPostCard(String name, JSONObject post) {
<span class="fc" id="L304">        TextView debug = findViewById(R.id.feedTxt);</span>
        //debug.setText(&quot;in add post&quot;);

<span class="fc" id="L307">        View view = getLayoutInflater().inflate(R.layout.post_container, null);</span>
<span class="fc" id="L308">        TextView usernameTxt = view.findViewById(R.id.usernameTextView);</span>
<span class="fc" id="L309">        TextView titleTxt = view.findViewById(R.id.titleTextView);</span>
<span class="fc" id="L310">        TextView msgTxt = view.findViewById(R.id.messageTextView);</span>
<span class="fc" id="L311">        TextView likesTxt = view.findViewById(R.id.likesTextView);</span>
<span class="fc" id="L312">        Button likeBtn = view.findViewById(R.id.likeBTN);</span>
        //profilePicOnPost = view.findViewById(R.id.postProfilePic);

        int postID;

        //debug.setText(debug.getText().toString() + &quot;\n&quot; + post.toString());

//        Toast.makeText(HomePage.this, &quot;adding card&quot; + post.toString(), Toast.LENGTH_SHORT).show();

<span class="pc bpc" id="L321" title="1 of 2 branches missed.">        if (name.equals(&quot;No Feed - Find friends to see their posts&quot;)) {</span>
<span class="nc" id="L322">            View Errorview = getLayoutInflater().inflate(R.layout.simple_text_box, null);</span>
<span class="nc" id="L323">            TextView text = findViewById(R.id.textView);</span>
<span class="nc" id="L324">            text.setText(&quot;No Feed - Find friends to see their post&quot;);</span>
<span class="nc" id="L325">            profileInfo.addView(Errorview);</span>
<span class="nc" id="L326">        } else {</span>
            try {
<span class="fc" id="L328">                usernameTxt.setText(&quot;&quot;); //leave blank until owner of post is passed</span>
<span class="fc" id="L329">                titleTxt.setText(post.getString(&quot;title&quot;));</span>
<span class="fc" id="L330">                msgTxt.setText(post.getString(&quot;message&quot;));</span>
<span class="fc" id="L331">                postID = post.getInt(&quot;id&quot;);</span>
<span class="fc" id="L332">                int numLikes = post.getInt(&quot;likes&quot;);</span>

<span class="fc" id="L334">                Log.d(&quot;NUM LIKES&quot;, &quot;Num Likes: &quot; + numLikes);</span>
<span class="pc bpc" id="L335" title="1 of 2 branches missed.">                if (numLikes &lt; 0) {</span>
<span class="nc" id="L336">                    numLikes = 0;</span>
                }
<span class="fc" id="L338">                likesTxt.setText(String.valueOf(numLikes));</span>

                //display image
                //displayProfilePicToCard(view, postID);

<span class="fc" id="L343">                likeBtn.setOnClickListener(new View.OnClickListener() {</span>
                    boolean hasLiked;

                    @Override
                    public void onClick(View v) {
                        //check if user has already liked it
                        try {
                            ///posts/person/{id}/like/{person}
<span class="fc" id="L351">                            String checkLikedURL = &quot;http://coms-309-067.class.las.iastate.edu:8080/posts/person/&quot; + postID + &quot;/like/&quot; + getIntent().getStringExtra(&quot;username&quot;);</span>
//                   Toast.makeText(GroupChatBanPage.this, name, Toast.LENGTH_LONG).show();
<span class="fc" id="L353">                            StringRequest stringRequest = new StringRequest(Request.Method.GET, checkLikedURL, new Response.Listener&lt;String&gt;() {</span>

                                @Override
                                public void onResponse(String response) {
<span class="fc" id="L357">                                    Log.d(&quot;LIKE BUTTON&quot;, &quot;HasLiked response:&quot; + response.toString());</span>

<span class="fc bfc" id="L359" title="All 2 branches covered.">                                    if (response.equals(&quot;liked&quot;)) {</span>
<span class="fc" id="L360">                                        hasLiked = true;</span>
<span class="fc" id="L361">                                        String unlikeURL = &quot;http://coms-309-067.class.las.iastate.edu:8080/posts/person/&quot; + postID + &quot;/unlike/&quot;+ getIntent().getStringExtra(&quot;username&quot;);</span>
<span class="fc" id="L362">                                        StringRequest unlikeRequest = new StringRequest(Request.Method.PUT, unlikeURL, new Response.Listener&lt;String&gt;() {</span>
                                            @Override
                                            public void onResponse(String response) {
<span class="fc" id="L365">                                                Toast.makeText(FriendsProfile.this, &quot;unliked&quot;, Toast.LENGTH_SHORT).show();</span>
                                                //update like counter in real time to prevent reloading feed.

<span class="fc" id="L368">                                                int decrementLikes = Integer.parseInt(likesTxt.getText().toString()) - 1;</span>
<span class="fc" id="L369">                                                String intToString = &quot;&quot; + decrementLikes;</span>
<span class="fc" id="L370">                                                likesTxt.setText(intToString);</span>
<span class="fc" id="L371">                                            }</span>
<span class="fc" id="L372">                                        }, new Response.ErrorListener() {</span>
                                            @Override
                                            public void onErrorResponse(VolleyError error) {
<span class="nc" id="L375">                                                Toast.makeText(FriendsProfile.this, &quot;Error unliking&quot;, Toast.LENGTH_SHORT).show();</span>
<span class="nc" id="L376">                                            }</span>
                                        });
                                        RequestQueue rq;
<span class="fc" id="L379">                                        rq = Volley.newRequestQueue(FriendsProfile.this);</span>
<span class="fc" id="L380">                                        rq.add(unlikeRequest);</span>
<span class="fc" id="L381">                                    }</span>
                                    else {
<span class="fc" id="L383">                                        hasLiked = false;</span>
<span class="fc" id="L384">                                        String likeURL = &quot;http://coms-309-067.class.las.iastate.edu:8080/posts/person/&quot; + postID + &quot;/like/&quot;+ getIntent().getStringExtra(&quot;username&quot;);</span>
<span class="fc" id="L385">                                        StringRequest likeRequest = new StringRequest(Request.Method.PUT, likeURL, new Response.Listener&lt;String&gt;() {</span>
                                            @Override
                                            public void onResponse(String response) {
<span class="fc" id="L388">                                                Toast.makeText(FriendsProfile.this, &quot;Liked&quot;, Toast.LENGTH_SHORT).show();</span>
                                                //update like counter in real time to prevent reloading feed.
<span class="fc" id="L390">                                                int incrementLikes = Integer.parseInt(likesTxt.getText().toString()) + 1;</span>
<span class="fc" id="L391">                                                String intToString = &quot;&quot; + incrementLikes;</span>
<span class="fc" id="L392">                                                likesTxt.setText(intToString);</span>
<span class="fc" id="L393">                                            }</span>
<span class="fc" id="L394">                                        }, new Response.ErrorListener() {</span>
                                            @Override
                                            public void onErrorResponse(VolleyError error) {
<span class="nc" id="L397">                                                Toast.makeText(FriendsProfile.this, &quot;Error Liked&quot;, Toast.LENGTH_SHORT).show();</span>
<span class="nc" id="L398">                                            }</span>
                                        });
                                        RequestQueue rq;
<span class="fc" id="L401">                                        rq = Volley.newRequestQueue(FriendsProfile.this);</span>
<span class="fc" id="L402">                                        rq.add(likeRequest);</span>
                                    }

<span class="fc" id="L405">                                }</span>
<span class="fc" id="L406">                            }, new Response.ErrorListener() {</span>
                                @Override
                                public void onErrorResponse(VolleyError error) {
<span class="nc" id="L409">                                    Log.d(&quot;hasliked error&quot;, error.toString());</span>
<span class="nc" id="L410">                                }</span>
                            }
                            );


<span class="fc" id="L415">                            Log.d(&quot;LIKE BUTTON&quot;, &quot;Hasliked: &quot; + hasLiked);</span>
<span class="fc" id="L416">                            Log.d(&quot;LIKE BUTTON&quot;, &quot;Post id: &quot; + postID);</span>


                            RequestQueue requestQueue;
<span class="fc" id="L420">                            requestQueue = Volley.newRequestQueue(FriendsProfile.this);</span>
<span class="fc" id="L421">                            requestQueue.add(stringRequest);</span>
<span class="nc" id="L422">                        } catch (Exception e) {</span>
<span class="nc" id="L423">                            e.printStackTrace();</span>
<span class="fc" id="L424">                        }</span>

<span class="fc" id="L426">                    }</span>
                });
<span class="fc" id="L428">                profileInfo.addView(view);</span>

<span class="nc" id="L430">            } catch (JSONException e) {</span>
<span class="nc" id="L431">                VolleyLog.d(TAG, &quot;addPostCard Error&quot;);</span>
<span class="fc" id="L432">            }</span>
        }

<span class="fc" id="L435">    }</span>
    private void loadProfilePic() {
<span class="fc" id="L437">            String PROFILEPICURL = GETUSERURL + getIntent().getStringExtra(&quot;friend&quot;) + &quot;/profilePicture&quot;;</span>

<span class="fc" id="L439">            StringRequest request = new StringRequest</span>
<span class="fc" id="L440">                    (Request.Method.GET, PROFILEPICURL, new Response.Listener&lt;String&gt;() {</span>
                        @Override
                        public void onResponse(String response) {
<span class="pc bpc" id="L443" title="1 of 2 branches missed.">                            if (!response.isEmpty()) {</span>

<span class="fc" id="L445">                                Log.d(&quot;Friend Pic&quot;, &quot;Loading profile picture&quot;);</span>
<span class="fc" id="L446">                                String imageUrl = PROFILEPICURL;</span>

                                // Execute an AsyncTask to load the image from the URL
<span class="fc" id="L449">                                new FriendsProfile.LoadImageTask().execute(imageUrl);</span>
<span class="fc" id="L450">                            } else {</span>
                                // generate custom profile pic from URL
<span class="nc" id="L452">                                Log.d(&quot;Friend Pic&quot;, &quot;Loading robot picture&quot;);</span>
<span class="nc" id="L453">                                String imageUrl = &quot;https://robohash.org/&quot; + getIntent().getStringExtra(&quot;friend&quot;);</span>

                                // Execute an AsyncTask to load the image from the URL
<span class="nc" id="L456">                                new FriendsProfile.LoadImageTask().execute(imageUrl);</span>
                            }
<span class="fc" id="L458">                        }</span>
<span class="fc" id="L459">                    }, new Response.ErrorListener() {</span>

                        @Override
                        public void onErrorResponse(VolleyError error) {
                            //Log.d(TAG, error.toString());
                            //Toast.makeText(FriendsProfile.this, error.toString(), Toast.LENGTH_LONG).show();
<span class="nc" id="L465">                            String imageUrl = &quot;https://robohash.org/&quot; + getIntent().getStringExtra(&quot;friend&quot;);</span>

                            // Execute an AsyncTask to load the image from the URL
<span class="nc" id="L468">                            new FriendsProfile.LoadImageTask().execute(imageUrl);</span>
<span class="nc" id="L469">                        }</span>
                    });
<span class="fc" id="L471">            RequestQueue rq = Volley.newRequestQueue(FriendsProfile.this);</span>
<span class="fc" id="L472">            rq.add(request);</span>
<span class="fc" id="L473">        }</span>
<span class="fc" id="L474">    private class LoadImageTask extends AsyncTask&lt;String, Void, byte[]&gt; {</span>

        @Override
        protected byte[] doInBackground(String... params) {
<span class="fc" id="L478">            String imageUrl = params[0];</span>

            try {
<span class="fc" id="L481">                URL url = new URL(imageUrl);</span>
<span class="fc" id="L482">                HttpURLConnection connection = (HttpURLConnection) url.openConnection();</span>
<span class="fc" id="L483">                connection.setDoInput(true);</span>
<span class="fc" id="L484">                connection.connect();</span>

<span class="fc" id="L486">                InputStream input = connection.getInputStream();</span>
<span class="fc" id="L487">                ByteArrayOutputStream output = new ByteArrayOutputStream();</span>

<span class="fc" id="L489">                byte[] buffer = new byte[4096];</span>
                int bytesRead;
<span class="fc bfc" id="L491" title="All 2 branches covered.">                while ((bytesRead = input.read(buffer)) != -1) {</span>
<span class="fc" id="L492">                    output.write(buffer, 0, bytesRead);</span>
                }

<span class="fc" id="L495">                input.close();</span>
<span class="fc" id="L496">                return output.toByteArray();</span>
<span class="nc" id="L497">            } catch (Exception e) {</span>
<span class="nc" id="L498">                Log.e(&quot;ImageLoading&quot;, &quot;Error loading image&quot;, e);</span>
<span class="nc" id="L499">                return null;</span>
            }
        }

        @Override
        protected void onPostExecute(byte[] imageBytes) {
<span class="pc bpc" id="L505" title="2 of 4 branches missed.">            if (imageBytes != null &amp;&amp; imageBytes.length &gt; 0) {</span>
                // Convert byte array to Bitmap
<span class="fc" id="L507">                Bitmap bitmap = BitmapFactory.decodeByteArray(imageBytes, 0, imageBytes.length);</span>

                // Set Bitmap to ImageView
<span class="fc" id="L510">                ProfilePicture.setImageBitmap(bitmap);</span>
<span class="fc" id="L511">            } else {</span>
<span class="nc" id="L512">                Log.e(&quot;ImageLoading&quot;, &quot;Empty or null byte array&quot;);</span>
            }
<span class="fc" id="L514">        }</span>
    }
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.8.202204050719</span>Generated by the Android Gradle plugin 8.1.1</div></body></html>